<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Winter Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            scrollbar-width: thin;
            scrollbar-color: #4a9fd8 #1a1a1a;
        }

        body {
            font-family: 'Poppins', sans-serif;
            height: 100vh;
            background: #0d1117;
            color: #e6edf3;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #4a9fd8;
            border-radius: 6px;
        }

        nav.tabs {
            display: flex;
            align-items: center;
            background: #0d1117;
            padding: 6px 0 6px 10px;
            gap: 4px;
            border-bottom: 1px solid #21262d;
            min-height: 34px;
            overflow-x: auto;
        }

            nav.tabs button {
                background: #161b22;
                border: 2px solid #30363d;
                padding: 5px 11px;
                border-radius: 6px;
                font-size: 0.7rem;
                color: #8b949e;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 6px;
                user-select: none;
                opacity: 0;
                transform: translateY(0);
                animation: fadeInTab 0.3s forwards;
                transition: transform 0.15s ease-in-out, background 0.15s, border 0.15s, color 0.15s;
                position: relative;
            }

                nav.tabs button.active {
                    background: #1c2128;
                    border: 2px solid #4a9fd8;
                    color: #e6edf3;
                    box-shadow: inset 0 2px 4px rgba(0,0,0,0.4);
                    transform: translateY(2px);
                }

                nav.tabs button:hover:not(.active) {
                    background: #1c2128;
                    border-color: #58a6ff;
                    color: #c9d1d9;
                }

                nav.tabs button:active {
                    transform: translateY(2px);
                }

        @keyframes fadeInTab {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOutTab {
            from {
                opacity: 1;
                transform: translateY(0);
            }

            to {
                opacity: 0;
                transform: translateY(-8px);
            }
        }

        nav.tabs button.closing {
            animation: fadeOutTab 0.3s forwards;
        }

        nav.tabs .close-btn {
            font-size: 0.8rem;
            opacity: 0.6;
            margin-left: 4px;
            cursor: pointer;
            background: transparent;
            border: none;
            color: inherit;
            transition: opacity 0.2s ease;
        }

            nav.tabs .close-btn:hover {
                opacity: 1;
            }

        nav.tabs .add-tab {
            width: 20px;
            height: 20px;
            font-size: 0.6rem;
            color: #58a6ff;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            margin-left: 6px;
            cursor: pointer;
            transition: all 0.15s ease-in-out;
        }

            nav.tabs .add-tab:hover {
                background: #1c2128;
                color: #4a9fd8;
                border-color: #4a9fd8;
                transform: scale(1.1);
            }

            nav.tabs .add-tab i {
                font-size: 0.6rem;
                pointer-events: none;
            }

        #editors-container {
            flex: 1;
            position: relative;
            background: #0d1117;
        }

        .editor-instance {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: none;
        }

            .editor-instance.active {
                display: block;
                z-index: 1;
            }

        .tab-content {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tab-label {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100px;
        }

        input.rename-input {
            font-family: 'Poppins', sans-serif;
            font-size: 0.7rem;
            background: #1c2128;
            color: #e6edf3;
            border: 1px solid #4a9fd8;
            border-radius: 4px;
            padding: 2px 6px;
            width: 100px;
        }
    </style>
</head>
<body>
    <nav class="tabs" id="tabs">
        <button class="add-tab" id="addTabBtn"><i class="fas fa-plus"></i></button>
    </nav>
    <div id="editors-container"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <script>
        let models = {}, editors = {}, activeTab = null, fileCounter = 1, monacoInstance;
        const tabsContainer = document.getElementById('tabs');
        const editorsContainer = document.getElementById('editors-container');
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' } });
        require(['vs/editor/editor.main'], () => {
            monacoInstance = monaco;
            monaco.editor.defineTheme('winterTheme', {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'comment', foreground: '6e7681', fontStyle: 'italic' },
                    { token: 'keyword', foreground: '58a6ff', fontStyle: 'bold' },
                    { token: 'string', foreground: '79c0ff' },
                    { token: 'number', foreground: '79c0ff' },
                    { token: 'function', foreground: 'd2a8ff' },
                    { token: 'variable', foreground: 'ffa657' },
                ],
                colors: {
                    'editor.background': '#0d1117',
                    'editor.foreground': '#e6edf3',
                    'editor.lineHighlightBackground': '#161b22',
                    'editorLineNumber.foreground': '#6e7681',
                    'editor.selectionBackground': '#1f6feb4d',
                    'editor.inactiveSelectionBackground': '#1f6feb26',
                    'editorCursor.foreground': '#58a6ff',
                }
            });
            addNewTab('main.lua');
        });
        function addNewTab(name) {
            const filename = name || `main${fileCounter++}.lua`;
            const model = monacoInstance.editor.createModel('print("Winter")', 'lua');
            models[filename] = model;
            const editorDiv = document.createElement('div');
            editorDiv.id = `editor-${filename}`;
            editorDiv.className = 'editor-instance';
            editorsContainer.appendChild(editorDiv);
            editors[filename] = monacoInstance.editor.create(editorDiv, {
                model: model,
                theme: 'winterTheme',
                fontSize: 14,
                fontFamily: 'Poppins',
                automaticLayout: true,
                smoothScrolling: false,
                cursorSmoothCaretAnimation: false,
                disableLayerHinting: true,
                fontLigatures: false,
                renderWhitespace: 'none',
                scrollBeyondLastLine: false
            });
            createTab(filename);
            switchTab(filename);
        }
        function createTab(filename) {
            const tab = document.createElement('button');
            tab.dataset.file = filename;
            const tabContent = document.createElement('div');
            tabContent.className = 'tab-content';
            const icon = document.createElement('i');
            icon.className = 'fas fa-file-code';
            const label = document.createElement('span');
            label.className = 'tab-label';
            label.textContent = filename;
            const closeBtn = document.createElement('span');
            closeBtn.className = 'close-btn';
            closeBtn.innerHTML = '&times;';
            closeBtn.onclick = e => {
                e.stopPropagation();
                closeTab(filename, tab);
            };
            tabContent.appendChild(icon);
            tabContent.appendChild(label);
            tab.appendChild(tabContent);
            tab.appendChild(closeBtn);
            tab.onclick = () => {
                if (!tab.querySelector('input.rename-input')) switchTab(filename);
            };
            tab.ondblclick = e => {
                e.stopPropagation();
                renameTab(tab, label);
            };
            tabsContainer.insertBefore(tab, document.getElementById('addTabBtn'));
        }
        function renameTab(tab, labelElement) {
            const currentName = tab.dataset.file;
            const input = document.createElement('input');
            input.className = 'rename-input';
            input.value = currentName;
            labelElement.replaceWith(input);
            input.focus();
            input.select();
            input.onblur = () => finishRename(input, tab, currentName);
            input.onkeydown = e => {
                if (e.key === 'Enter') input.blur();
                if (e.key === 'Escape') input.replaceWith(labelElement);
            };
        }
        function finishRename(input, tab, oldName) {
            const newName = input.value.trim();
            if (!newName || models[newName]) return input.replaceWith(document.createTextNode(oldName));
            models[newName] = models[oldName];
            delete models[oldName];
            editors[newName] = editors[oldName];
            delete editors[oldName];
            const div = document.getElementById(`editor-${oldName}`);
            div.id = `editor-${newName}`;
            tab.dataset.file = newName;
            const label = document.createElement('span');
            label.className = 'tab-label';
            label.textContent = newName;
            input.replaceWith(label);
            switchTab(newName);
        }
        function switchTab(filename) {
            if (!models[filename]) return;
            activeTab = filename;
            [...tabsContainer.children].forEach(tab => {
                tab.classList.toggle('active', tab.dataset.file === filename);
            });
            [...editorsContainer.children].forEach(div => {
                div.classList.remove('active');
            });
            const activeDiv = document.getElementById(`editor-${filename}`);
            if (activeDiv) activeDiv.classList.add('active');
        }
        function closeTab(filename, tab) {
            tab.classList.add('closing');
            setTimeout(() => tab.remove(), 300);
            if (editors[filename]) {
                editors[filename].dispose();
                delete editors[filename];
            }
            if (models[filename]) {
                models[filename].dispose();
                delete models[filename];
            }
            document.getElementById(`editor-${filename}`)?.remove();
            if (activeTab === filename) {
                const remaining = Object.keys(models);
                if (remaining.length > 0) switchTab(remaining[0]);
                else activeTab = null;
            }
        }
        document.getElementById('addTabBtn').onclick = () => addNewTab();
        window.getEditorValue = () => activeTab ? editors[activeTab].getValue() : '';
        window.setEditorValue = content => {
            if (activeTab) editors[activeTab].setValue(content);
        };
    </script>
</body>
</html>
