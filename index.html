<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Flare Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            scrollbar-width: thin;
            scrollbar-color: #ff6b35 #0f0f0f;
        }

        body {
            font-family: 'Poppins', sans-serif;
            height: 100vh;
            background: #0f0f0f;
            color: #fff5e6;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0f0f0f;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #ff6b35 0%, #ff8c42 100%);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #ff8c42 0%, #ffa552 100%);
        }

        nav.tabs {
            display: flex;
            align-items: center;
            background: linear-gradient(180deg, #1a1a1a 0%, #141414 100%);
            padding: 6px 0 6px 10px;
            gap: 4px;
            border-bottom: 2px solid #ff6b35;
            min-height: 34px;
            overflow-x: auto;
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.2);
        }

        nav.tabs button {
            background: linear-gradient(180deg, #1a1a1a 0%, #141414 100%);
            border: 2px solid #2a2a2a;
            padding: 5px 11px;
            border-radius: 6px;
            font-size: 0.7rem;
            color: #999;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            user-select: none;
            opacity: 0;
            transform: translateY(0);
            animation: fadeInTab 0.3s forwards;
            transition: transform 0.15s ease-in-out, background 0.15s, border 0.15s, color 0.15s, box-shadow 0.15s;
            position: relative;
        }

        nav.tabs button.active {
            background: linear-gradient(180deg, #2a2a2a 0%, #1f1f1f 100%);
            border: 2px solid #ff6b35;
            color: #fff5e6;
            box-shadow: 0 0 12px rgba(255, 107, 53, 0.4), inset 0 2px 4px rgba(0,0,0,0.4);
            transform: translateY(2px);
        }

        nav.tabs button:hover:not(.active) {
            background: linear-gradient(180deg, #252525 0%, #1a1a1a 100%);
            border-color: #ff8c42;
            color: #ffa552;
            box-shadow: 0 0 8px rgba(255, 140, 66, 0.3);
        }

        nav.tabs button:active {
            transform: translateY(2px);
        }

        @keyframes fadeInTab {
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOutTab {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-8px); }
        }

        nav.tabs button.closing {
            animation: fadeOutTab 0.3s forwards;
        }

        nav.tabs .close-btn {
            font-size: 0.8rem;
            opacity: 0.6;
            margin-left: 4px;
            cursor: pointer;
            background: transparent;
            border: none;
            color: inherit;
            transition: opacity 0.2s ease, color 0.2s ease;
        }

        nav.tabs .close-btn:hover {
            opacity: 1;
            color: #ff6b35;
        }

        nav.tabs .add-tab {
            width: 20px;
            height: 20px;
            font-size: 0.6rem;
            color: #999;
            background: linear-gradient(180deg, #1a1a1a 0%, #141414 100%);
            border: 1px solid #2a2a2a;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            margin-left: 6px;
            cursor: pointer;
            transition: all 0.15s ease-in-out;
        }

        nav.tabs .add-tab:hover {
            background: linear-gradient(180deg, #ff6b35 0%, #ff8c42 100%);
            color: #fff;
            border-color: #ff6b35;
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.5);
        }

        nav.tabs .add-tab i { font-size: 0.6rem; pointer-events: none; }

        #editors-container {
            flex: 1;
            position: relative;
            background: #0f0f0f;
        }

        .editor-instance {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: none;
        }

        .editor-instance.active { display: block; z-index: 1; }

        .tab-content { display: flex; align-items: center; gap: 5px; }

        .tab-label {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100px;
        }

        input.rename-input {
            font-family: 'Poppins', sans-serif;
            font-size: 0.7rem;
            background: #1a1a1a;
            color: #fff5e6;
            border: 1px solid #ff6b35;
            border-radius: 4px;
            padding: 2px 6px;
            width: 100px;
        }

        input.rename-input:focus {
            outline: none;
            box-shadow: 0 0 8px rgba(255, 107, 53, 0.4);
        }
    </style>
</head>
<body>
    <nav class="tabs" id="tabs">
        <button class="add-tab" id="addTabBtn"><i class="fas fa-plus"></i></button>
    </nav>
    <div id="editors-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <script>
        let models = {}, editors = {}, activeTab = null, fileCounter = 1, monacoInstance;
        const tabsContainer = document.getElementById('tabs');
        const editorsContainer = document.getElementById('editors-container');

        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' } });
        require(['vs/editor/editor.main'], () => {
            monacoInstance = monaco;

            monaco.editor.defineTheme('flareTheme', {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'comment', foreground: '6e7681', fontStyle: 'italic' },
                    { token: 'keyword', foreground: 'ff6b35', fontStyle: 'bold' },
                    { token: 'string', foreground: 'ffa552' },
                    { token: 'number', foreground: 'ffcc80' },
                    { token: 'function', foreground: 'ff8c42' },
                    { token: 'variable', foreground: 'ffb366' },
                ],
                colors: {
                    'editor.background': '#0f0f0f',
                    'editor.foreground': '#fff5e6',
                    'editor.lineHighlightBackground': '#1a1a1a',
                    'editorLineNumber.foreground': '#6e7681',
                    'editorLineNumber.activeForeground': '#ff6b35',
                    'editor.selectionBackground': '#ff6b3540',
                    'editor.inactiveSelectionBackground': '#ff6b3520',
                    'editorCursor.foreground': '#ff6b35',
                    'editorIndentGuide.background': '#2a2a2a',
                    'editorIndentGuide.activeBackground': '#ff6b3530',
                }
            });

            addNewTab('main.lua');
        });

        function addNewTab(name) {
            const filename = name || `main${fileCounter++}.lua`;
            const model = monacoInstance.editor.createModel('print("Flare Editor")', 'lua');
            models[filename] = model;
            const editorDiv = document.createElement('div');
            editorDiv.id = `editor-${filename}`;
            editorDiv.className = 'editor-instance';
            editorsContainer.appendChild(editorDiv);
            editors[filename] = monacoInstance.editor.create(editorDiv, {
                model: model,
                theme: 'flareTheme',
                fontSize: 14,
                fontFamily: "'JetBrains Mono', 'Consolas', 'Courier New', monospace",
                fontLigatures: true,
                automaticLayout: true,
                cursorSmoothCaretAnimation: 'on',
                cursorBlinking: 'smooth',
                minimap: { enabled: false },
                scrollbar: {
                    vertical: 'auto',
                    horizontal: 'auto',
                    verticalScrollbarSize: 8,
                    horizontalScrollbarSize: 8
                }
            });

            createTab(filename);
            switchTab(filename);
        }

        function createTab(filename) {
            const tab = document.createElement('button');
            tab.dataset.file = filename;
            const tabContent = document.createElement('div');
            tabContent.className = 'tab-content';
            const icon = document.createElement('i');
            icon.className = 'fas fa-file-code';
            const label = document.createElement('span');
            label.className = 'tab-label';
            label.textContent = filename;
            const closeBtn = document.createElement('span');
            closeBtn.className = 'close-btn';
            closeBtn.innerHTML = '&times;';
            closeBtn.onclick = e => { e.stopPropagation(); closeTab(filename, tab); };
            tabContent.appendChild(icon);
            tabContent.appendChild(label);
            tab.appendChild(tabContent);
            tab.appendChild(closeBtn);
            tab.onclick = () => { if (!tab.querySelector('input.rename-input')) switchTab(filename); };
            tab.ondblclick = e => { e.stopPropagation(); renameTab(tab, label); };
            tabsContainer.insertBefore(tab, document.getElementById('addTabBtn'));
        }

        function switchTab(filename) {
            if (!models[filename]) return;
            activeTab = filename;
            [...tabsContainer.children].forEach(tab => {
                const isActive = tab.dataset.file === filename;
                tab.classList.toggle('active', isActive);
            });
            [...editorsContainer.children].forEach(div => div.classList.remove('active'));
            const activeDiv = document.getElementById(`editor-${filename}`);
            if (activeDiv) activeDiv.classList.add('active');
        }

        function closeTab(filename, tab) {
            tab.classList.add('closing');
            setTimeout(() => tab.remove(), 300);
            if (editors[filename]) { editors[filename].dispose(); delete editors[filename]; }
            if (models[filename]) { models[filename].dispose(); delete models[filename]; }
            document.getElementById(`editor-${filename}`)?.remove();
            if (activeTab === filename) {
                const remaining = Object.keys(models);
                if (remaining.length > 0) switchTab(remaining[0]);
                else activeTab = null;
            }
        }

        function renameTab(tab, label) {
            const oldFilename = tab.dataset.file;
            const input = document.createElement('input');
            input.className = 'rename-input';
            input.type = 'text';
            input.value = oldFilename;
            label.replaceWith(input);
            input.focus();
            input.select();

            const finishRename = () => {
                const newFilename = input.value.trim() || oldFilename;
                if (newFilename !== oldFilename && !models[newFilename]) {
                    models[newFilename] = models[oldFilename];
                    editors[newFilename] = editors[oldFilename];
                    delete models[oldFilename];
                    delete editors[oldFilename];
                    tab.dataset.file = newFilename;
                    const editorDiv = document.getElementById(`editor-${oldFilename}`);
                    if (editorDiv) editorDiv.id = `editor-${newFilename}`;
                    if (activeTab === oldFilename) activeTab = newFilename;
                }
                const newLabel = document.createElement('span');
                newLabel.className = 'tab-label';
                newLabel.textContent = tab.dataset.file;
                input.replaceWith(newLabel);
            };

            input.addEventListener('blur', finishRename);
            input.addEventListener('keydown', e => {
                if (e.key === 'Enter') finishRename();
                if (e.key === 'Escape') { input.value = oldFilename; finishRename(); }
            });
        }

        document.getElementById('addTabBtn').onclick = () => addNewTab();

        window.getEditorValue = () => activeTab ? editors[activeTab].getValue() : '';
        window.setEditorValue = content => { if (activeTab) editors[activeTab].setValue(content); };
    </script>
</body>
</html>
